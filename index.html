<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zápis služeb záchranáře</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { padding-top: 20px; }
pre { white-space: pre-wrap; }
</style>
</head>
<body>
<div class="container">
  <h1 class="mb-4">Zápis služeb záchranáře</h1>
  <form id="serviceForm" class="row g-3">
    <div class="col-md-3">
      <label class="form-label">Datum</label>
      <input type="date" id="date" class="form-control" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Od</label>
      <input type="time" id="timeStart" class="form-control" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Do</label>
      <input type="time" id="timeEnd" class="form-control" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Použitá vozidla</label>
      <input type="text" id="vehicles" class="form-control" placeholder="např. AMB01, emsheli5">
    </div>
    <div class="col-md-6">
      <label class="form-label">Poznámka</label>
      <input type="text" id="note" class="form-control">
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary">Přidat službu</button>
    </div>
  </form>

  <hr>

  <h2>Seznam služeb</h2>
  <pre id="logOutput" class="border p-3"></pre>
  <button id="copyBtn" class="btn btn-secondary">Kopírovat výstup</button>

  <hr>
  <h2>Odeslat zprávu vedení</h2>
  <form id="messageForm">
    <div class="mb-3">
      <label class="form-label">Zpráva</label>
      <textarea class="form-control" id="message" rows="3" required></textarea>
    </div>
    <button type="submit" class="btn btn-success">Odeslat</button>
  </form>
</div>

<script>
const logs = [];
const weekTotals = {};
const form = document.getElementById('serviceForm');
const output = document.getElementById('logOutput');

function minutesToHM(mins) {
  const h = Math.floor(mins / 60);
  const m = mins % 60;
  return `${h}h ${m}min`;
}

function getMonday(d) {
  const date = new Date(d);
  const day = date.getDay();
  const diff = (day + 6) % 7; // days since Monday
  date.setDate(date.getDate() - diff);
  date.setHours(0,0,0,0);
  return date.toISOString().slice(0,10);
}

form.addEventListener('submit', e => {
  e.preventDefault();
  const date = document.getElementById('date').value;
  const start = document.getElementById('timeStart').value;
  const end = document.getElementById('timeEnd').value;
  const vehicles = document.getElementById('vehicles').value;
  const note = document.getElementById('note').value;
  if(!date || !start || !end) return;
  const startDate = new Date(`${date}T${start}`);
  const endDate = new Date(`${date}T${end}`);
  let diff = (endDate - startDate) / 60000; // minutes
  if(diff < 0) diff += 24*60; // overnight
  const weekKey = getMonday(date);
  weekTotals[weekKey] = (weekTotals[weekKey] || 0) + diff;
  const entry = {
    date,
    start,
    end,
    vehicles,
    note,
    duration: diff,
    weekTotal: weekTotals[weekKey]
  };
  logs.push(entry);
  renderLogs();
  form.reset();
});

function renderLogs() {
  output.textContent = logs.map(l => `Datum: ${l.date}\nOd - do: ${l.start}–${l.end}\nPoužitá vozidla: ${l.vehicles}\nPoznámka: ${l.note}\nPočet hodin za danou službu: ${minutesToHM(l.duration)}\nCelkový počet hodin za týden: ${minutesToHM(l.weekTotal)}\n---`).join('\n');
}

document.getElementById('copyBtn').addEventListener('click', () => {
  navigator.clipboard.writeText(output.textContent);
});

// message form - use mailto
const messageForm = document.getElementById('messageForm');
messageForm.addEventListener('submit', e => {
  e.preventDefault();
  const msg = document.getElementById('message').value;
  const mailLink = `mailto:management@example.com?subject=Zprava%20vedeni&body=${encodeURIComponent(msg)}`;
  window.location.href = mailLink;
});
</script>

</body>
</html>
